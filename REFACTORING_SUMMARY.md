# üìã –°–≤–æ–¥–∫–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–î–∞—Ç–∞:** 2025-01-13  
**–í–µ—Ä—Å–∏—è:** 4.0 - –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `prompts/` –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–æ–¥—É–ª–∏ `crypto/` –∏ `stocks/` –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ —Ç–∏–ø–∞–º –∞–∫—Ç–∏–≤–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ –ø—Ä–æ–º–ø—Ç–∞–º –≤ `config.py` –∏ `ai/deepseek_client.py`

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞

- ‚úÖ –°–æ–∑–¥–∞–Ω `utils/asset_detector.py` —Å –∫–ª–∞—Å—Å–æ–º `AssetTypeDetector`
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `AssetTypeDetector`
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ `_detect_asset_type()`

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `data_providers/__init__.py`
- `stages/stage1_filter.py`
- `stages/stage2_selection.py`
- `stages/stage3_analysis.py`
- `indicators/news_analysis.py`
- `telegram/formatters.py`

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è batch –∑–∞–≥—Ä—É–∑–∫–∏

- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π (–ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø—É –∞–∫—Ç–∏–≤–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### 4. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —ç—Ç–∞–ø–æ–≤

**Stage 1:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AssetTypeDetector` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–µ –∫–∞–∂–¥—ã–π —à–∞–≥)
- ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**Stage 2:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AssetTypeDetector`
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ LEGACY —Ñ—É–Ω–∫—Ü–∏—è `_prepare_levels_data_with_history()`

**Stage 3:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (BTC –¥–ª—è crypto, MOEX –¥–ª—è stocks)
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 5. –ë–µ–∫—Ç–µ—Å—Ç–∏–Ω–≥

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `fetch_candles()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–µ—á–µ–π
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è crypto –∏ stocks

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ, –Ω–æ –Ω–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ
- ‚úÖ –õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–∞–ø–æ–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG
- ‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ –°–æ–∑–¥–∞–Ω `README.md` —Å –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `ARCHITECTURE.md` –∫–∞–∫ —Å–≤–æ–¥ –ø—Ä–∞–≤–∏–ª –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å

- –ö–∞–∂–¥—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ crypto/stocks –º–æ–¥—É–ª–µ–π
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ batch –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è 300 —Ç–∏–∫–µ—Ä–æ–≤
- –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ü–∏–∫–ª–∞—Ö

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- –ß–µ—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ ARCHITECTURE.md

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `utils/asset_detector.py` - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞
- `crypto/__init__.py` - –ú–æ–¥—É–ª—å –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
- `stocks/__init__.py` - –ú–æ–¥—É–ª—å –¥–ª—è –∞–∫—Ü–∏–π
- `prompts/` - –ü–∞–ø–∫–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤ (–ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –∏–∑ `ai/prompts/`)
- `README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `ARCHITECTURE.md` - –ü—Ä–∞–≤–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–ø–µ—Ä–µ–ø–∏—Å–∞–Ω)

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `data_providers/__init__.py` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AssetTypeDetector, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ batch –∑–∞–≥—Ä—É–∑–∫–∞
- `stages/stage1_filter.py` - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AssetTypeDetector
- `stages/stage2_selection.py` - –£–¥–∞–ª–µ–Ω–∞ LEGACY —Ñ—É–Ω–∫—Ü–∏—è, —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `stages/stage3_analysis.py` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞, —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `utils/backtesting.py` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞
- `indicators/news_analysis.py` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AssetTypeDetector
- `telegram/formatters.py` - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AssetTypeDetector
- `ai/deepseek_client.py` - –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ –ø—Ä–æ–º–ø—Ç–∞–º
- `config.py` - –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ –ø—Ä–æ–º–ø—Ç–∞–º

### –£–¥–∞–ª–µ–Ω–Ω—ã–π –∫–æ–¥

- LEGACY —Ñ—É–Ω–∫—Ü–∏—è `_prepare_levels_data_with_history()` –≤ `stage2_selection.py`
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ—É–Ω–∫—Ü–∏–∏ `_detect_asset_type()` –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥—É–ª—è—Ö

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –∞–∫—Ç–∏–≤–æ–≤
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ö–∞–∂–¥—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ batch –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è 300 —Ç–∏–∫–µ—Ä–æ–≤
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ü–∏–∫–ª–∞—Ö
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∂–µ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ –ß–µ—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ ARCHITECTURE.md
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `README.md` - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- `ARCHITECTURE.md` - –ü—Ä–∞–≤–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- `REFACTORING_SUMMARY.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ–º–ø—Ç—ã**: –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ `prompts/`, –Ω–æ —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ –≤ `ai/prompts/` –≤—Å–µ –µ—â–µ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

2. **AssetTypeDetector**: –¢–µ–ø–µ—Ä—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–∞. –í—Å–µ –º–æ–¥—É–ª–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.

3. **Batch –∑–∞–≥—Ä—É–∑–∫–∞**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö –±–∞—Ç—á–µ–π (300+ —Ç–∏–∫–µ—Ä–æ–≤). –ü—Ä–æ–≥—Ä–µ—Å—Å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£—Ä–æ–≤–µ–Ω—å INFO –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–∞–ø–æ–≤. –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG.

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º–∏
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∞–∫—Ü–∏—è–º–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∫—Ç–µ—Å—Ç–∏–Ω–≥ –¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –∞–∫—Ç–∏–≤–æ–≤
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω:** 2025-01-13  
**–í–µ—Ä—Å–∏—è:** 4.0
